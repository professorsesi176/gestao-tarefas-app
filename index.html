<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GestÃ£o de Tarefas</title>
<style>
body {
  background-color: #fff;
  font-family: 'Segoe UI', sans-serif;
  margin: 0;
  padding: 0;
}
header {
  background: #b30000;
  color: white;
  text-align: center;
  padding: 1rem;
  font-size: 2rem;
  font-weight: bold;
}
.login-box {
  width: 340px;
  margin: 5rem auto;
  background: #f5f5f5;
  padding: 2rem;
  border-radius: 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}
input {
  width: 100%;
  margin-bottom: 1rem;
  padding: 0.6rem;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 1rem;
}
button {
  background: #b30000;
  color: white;
  border: none;
  padding: 0.8rem 1.2rem;
  border-radius: 8px;
  cursor: pointer;
  font-size: 1rem;
}
button:hover {
  background: #e60000;
}
#logoutBtn {
  background: black;
  color: white;
  padding: 0.5rem 1rem;
  font-size: 0.8rem;
  float: right;
  margin: 0.5rem;
  border-radius: 8px;
}
.container {
  padding: 2rem;
}
footer {
  text-align: center;
  margin-top: 2rem;
  color: gray;
}
</style>
</head>
<body>
<header>
  GestÃ£o de Tarefas
  <button id="logoutBtn" onclick="logout()">Sair</button>
</header>

<div id="login" class="login-box">
  <h2>Entrar</h2>
  <input id="email" placeholder="E-mail" type="email">
  <input id="ra" placeholder="RA" type="text">
  <button onclick="login()">Entrar</button>
</div>

<div id="app" class="container" style="display:none;">
  <h2 id="saudacao"></h2>
  <div id="conteudo"></div>
</div>

<footer>Desenvolvido por Geovane MÃ³dena</footer>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzKymbA3QgIdhBw7AfUJQveK3l3gbzT-2eccOJpF1K4E-HrEc51pefiJFWCEnDWZm4V/exec";
let usuarioAtual = null;

async function login() {
  const email = document.getElementById("email").value.trim();
  const ra = document.getElementById("ra").value.trim();

  const resp = await fetch(`${API_URL}?func=getUsers`);
  const data = await resp.json();
  const users = data.users;

  const user = users.find(u => u.Email == email && String(u.RA) == ra);
  if (!user) {
    alert("UsuÃ¡rio nÃ£o encontrado!");
    return;
  }

  usuarioAtual = user;
  document.getElementById("login").style.display = "none";
  document.getElementById("app").style.display = "block";
  document.getElementById("saudacao").innerText = `OlÃ¡, ${user.NomeCompleto}!`;

  if (user.Turma.toLowerCase() === "professor" || (user.Email === "professorsesi176@gmail.com" && ra === "9999")) {
    carregarTelaProfessor();
  } else {
    carregarTelaAluno();
  }
}

function logout() {
  location.reload();
}

/** TELA PROFESSOR **/
async function carregarTelaProfessor() {
  const c = document.getElementById("conteudo");
  c.innerHTML = `
    <h3>Gerenciar Tarefas</h3>
    <button onclick="mostrarNovaTarefa()">âž• Nova Tarefa</button>
    <div id="listaTarefas"></div>
  `;
  listarTarefas();
}

async function listarTarefas() {
  const c = document.getElementById("listaTarefas");
  const resp = await fetch(`${API_URL}?func=getTarefas`);
  const data = await resp.json();
  const tarefas = data.tarefas;
  c.innerHTML = tarefas.map(t => `
    <div style="border:1px solid #ccc; padding:10px; margin:10px; border-radius:10px;">
      <b>${t.Tema}</b> - ${t.Turma}<br>
      <button onclick="editarTarefa(${t.ID})">ðŸ’¾ Editar</button>
      <button onclick="excluirTarefa(${t.ID})" style="background:black;">ðŸ—‘ Excluir</button>
    </div>
  `).join("");
}

function mostrarNovaTarefa() {
  const c = document.getElementById("conteudo");
  c.innerHTML = `
    <h3>Criar Nova Tarefa</h3>
    <label>Turmas:</label><br>
    <input type="checkbox" value="1A">1A 
    <input type="checkbox" value="1B">1B 
    <input type="checkbox" value="2A">2A 
    <input type="checkbox" value="2B">2B 
    <input type="checkbox" value="3A">3A 
    <input type="checkbox" value="3B">3B <br><br>
    <input id="tema" placeholder="Tema"><br>
    <textarea id="parte1" placeholder="Parte 1"></textarea><br>
    <textarea id="parte2" placeholder="Parte 2"></textarea><br>
    <textarea id="parte3" placeholder="Parte 3"></textarea><br>
    <textarea id="parte4" placeholder="Parte 4"></textarea><br>
    <input id="dataaula" type="date"><br><br>
    <button onclick="salvarTarefa()">ðŸ’¾ Salvar</button>
  `;
}

async function salvarTarefa() {
  const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
  const Turmas = Array.from(checkboxes).map(cb => cb.value);
  const Tema = document.getElementById("tema").value;
  const DataAula = document.getElementById("dataaula").value;
  const Parte1 = document.getElementById("parte1").value;
  const Parte2 = document.getElementById("parte2").value;
  const Parte3 = document.getElementById("parte3").value;
  const Parte4 = document.getElementById("parte4").value;

  const resp = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "novaTarefa", Turmas, Tema, Parte1, Parte2, Parte3, Parte4, DataAula })
  });
  alert("Tarefa salva!");
  carregarTelaProfessor();
}

/** TELA ALUNO **/
async function carregarTelaAluno() {
  const c = document.getElementById("conteudo");
  const resp = await fetch(`${API_URL}?func=getTarefas`);
  const data = await resp.json();
  const tarefas = data.tarefas.filter(t => t.Turma == usuarioAtual.Turma);

  c.innerHTML = "<h3>Suas Tarefas</h3>" + tarefas.map(t => `
    <div style="border:1px solid #ccc; padding:10px; margin:10px; border-radius:10px;">
      <b>${t.Tema}</b> - Data da aula: ${t.DataAula}<br>
      <input id="link1_${t.ID}" placeholder="Link 1">
      <input id="link2_${t.ID}" placeholder="Link 2">
      <input id="link3_${t.ID}" placeholder="Link 3">
      <input id="link4_${t.ID}" placeholder="Link 4"><br>
      <button onclick="enviarLinks(${t.ID})">ðŸ’¾ Enviar</button>
    </div>
  `).join("");
}

async function enviarLinks(id) {
  const RA = usuarioAtual.RA;
  const NomeCompleto = usuarioAtual.NomeCompleto;
  const Turma = usuarioAtual.Turma;
  const Link1 = document.getElementById(`link1_${id}`).value;
  const Link2 = document.getElementById(`link2_${id}`).value;
  const Link3 = document.getElementById(`link3_${id}`).value;
  const Link4 = document.getElementById(`link4_${id}`).value;

  const resp = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({ action: "enviarEntrega", RA, NomeCompleto, Turma, ID_Tarefa: id, Link1, Link2, Link3, Link4 })
  });
  alert("Entrega enviada com sucesso!");
}
</script>
</body>
</html>
